@prefix s-wf: <http://semantic-machines.com/veda/simple-workflow/>.
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>.
@prefix v-wf: <http://www.w3.org/2001/veda-workflow/>.
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#>.
@prefix s-wfc: <http://semantic-machines.com/veda/simple-workflow-cr/>.
@prefix v-s: <http://semantic-machines.com/veda/veda-schema/>.
@prefix xsd: <http://www.w3.org/2001/XMLSchema#>.
@prefix td: <http://semantic-machines.com/veda/test-data/>.
@prefix d: <http://semantic-machines.com/veda/veda-data/>.
@prefix owl: <http://www.w3.org/2002/07/owl#> .

<http://semantic-machines.com/veda/complex-route-template>
  rdf:type owl:Ontology ;
  owl:imports <http://semantic-machines.com/veda/veda-workflow> ;
  rdfs:label "Онтология подсети автопоручений"@ru ;
  rdfs:label "Autoinstruction oute ontology"@en ;
  v-s:loadPriority 21 ;
.

s-wf:subnet_autoinstruction_route a v-wf:Net;
    rdfs:isDefinedBy "http://semantic-machines.com/veda/complex-route-template"^^xsd:string;
    rdfs:label "Подсеть автопоручений"^^xsd:string;
    v-s:updateCounter "3"^^xsd:integer;
    v-wf:consistsOf d:rkqt78slxs4o8z8it6fgf47e, d:task_autoinstruction_subnet_journal, d:fszmffnqwfeqxxwr48vi9rq8, d:task_autoinstruction_to_release, d:a33jy1sb1inmegt5j9ncswprh, d:mu18gdzzvp99huwicvj1qkre, d:task_autoinstruction_to_release_link, d:o7ey2dszv23ykoqz5mra9r8o ;
    v-wf:consistsOf d:bt9k3jv4npxhj74qh7bbxq15, d:task_autoinstruction_subnet_journal_hasFlow, d:p1xmw8wb8k9cjjzgl5zifa65, d:a4m2zxiha6f1rb5rgc4dg5qfj, d:avqe3hv87i5asi5kfcpu9oop, d:bq1fgy9pb3rbz0bj43x4n41q, d:rcw2c3a6efnmksft540vhdhj, d:task_autoinstruction_to_release_link_hasFlow ;
    v-wf:inputVariable s-wf:var_doc_id, s-wf:var_journal_initiator ;
.

d:rkqt78slxs4o8z8it6fgf47e a v-wf:InputCondition;
    rdfs:isDefinedBy "http://semantic-machines.com/veda/complex-route-template"^^xsd:string;
    v-s:updateCounter "1"^^xsd:integer;
    v-wf:hasFlow d:bt9k3jv4npxhj74qh7bbxq15;
    v-wf:locationX "0"^^xsd:integer;
    v-wf:locationY "284"^^xsd:integer;
.

d:o7ey2dszv23ykoqz5mra9r8o a v-wf:OutputCondition;
    rdfs:isDefinedBy "http://semantic-machines.com/veda/complex-route-template"^^xsd:string;
    v-s:updateCounter "1"^^xsd:integer;
    v-wf:locationX "679"^^xsd:integer;
    v-wf:locationY "243"^^xsd:integer;
.

d:task_autoinstruction_to_release a v-wf:Task;
    rdfs:isDefinedBy "http://semantic-machines.com/veda/complex-route-template"^^xsd:string;
    rdfs:label "Выдача задач"^^xsd:string;
    v-s:updateCounter "2"^^xsd:integer;
    v-wf:completedJournalMap s-wf:map_journal_msg_4_task_label_complete, s-wf:map_jrn_ev_type_4_TaskCompleted, s-wf:map_journal_doc_id, s-wf:map_journal_process_id;
    v-wf:completedMapping s-wf:m_result_f_out_var, s-wf:map_decision_of_set_responsible;
    v-wf:executor d:executor_from_activity_responsible1;
    v-wf:hasFlow d:a4m2zxiha6f1rb5rgc4dg5qfj, d:avqe3hv87i5asi5kfcpu9oop;
    v-wf:join v-wf:None;
    v-wf:locationX "323"^^xsd:integer;
    v-wf:locationY "238"^^xsd:integer;
    v-wf:split v-wf:None;
    v-wf:startingMapping d:task_autoinstruction_map_controller, s-wf:map_msg_template_autoinstruction-universal, s-wf:map_doc_id_from_executor, d:task_autoinstraction_decision_for_instruction, d:map_decision_form_type_autoinstruction, d:map_autoinstruction_task_action, d:map_autoinstraction_to_date, s-wf:map_initiator;
    v-wf:subNet s-wf:net_coordination;
.

d:task_autoinstruction_to_release_link a v-wf:Task;
    rdfs:isDefinedBy "http://semantic-machines.com/veda/complex-route-template"^^xsd:string;
    rdfs:label "Обработка ответов"^^xsd:string;
    v-s:updateCounter "1"^^xsd:integer;
    v-wf:completedMapping s-wf:m_result_f_out_var, s-wf:map_decision_of_set_responsible;
    v-wf:executor d:executor_autoinstruction_notification_response;
    v-wf:hasFlow d:task_autoinstruction_to_release_link_hasFlow;
    v-wf:join v-wf:None;
    v-wf:locationX "523"^^xsd:integer;
    v-wf:locationY "238"^^xsd:integer;
    v-wf:split v-wf:None;
    v-wf:startingMapping s-wf:map_doc_id, d:map_autoinstraction_notification_response;
.

d:task_autoinstruction_to_release_link_hasFlow
    a v-wf:Flow;
    rdfs:label ""^^xsd:string;
    v-wf:predicate "true"^^xsd:string;
    v-wf:flowsInto d:o7ey2dszv23ykoqz5mra9r8o;
.

d:bt9k3jv4npxhj74qh7bbxq15 a v-wf:Flow;
    rdfs:isDefinedBy "http://semantic-machines.com/veda/complex-route-template"^^xsd:string;
    rdfs:label ""^^xsd:string;
    v-s:updateCounter "1"^^xsd:integer;
    v-wf:flowsInto d:task_autoinstruction_subnet_journal;
.

d:a4m2zxiha6f1rb5rgc4dg5qfj a v-wf:Flow;
    rdfs:isDefinedBy "http://semantic-machines.com/veda/complex-route-template"^^xsd:string;
    rdfs:label ""^^xsd:string;
    v-s:updateCounter "7"^^xsd:integer;
    v-wf:flowsInto d:a33jy1sb1inmegt5j9ncswprh;
    v-wf:predicate "true"^^xsd:string, "getUri (get_properties_chain (process.getLocalVariable ('decision_of_set_responsible'), [{$get:'rdf:type'}])) != 'v-wf:DecisionAcceptMotivatedRefusal'"^^xsd:string;
.

d:task_autoinstruction_subnet_journal a v-wf:Task;
    rdfs:isDefinedBy "http://semantic-machines.com/veda/complex-route-template"^^xsd:string;
    rdfs:label "Журнал по мероприятиям"^^xsd:string;
    v-s:updateCounter "1"^^xsd:integer;
    v-wf:executor d:executor_subnet_journal;
    v-wf:hasFlow d:task_autoinstruction_subnet_journal_hasFlow;
    v-wf:join v-wf:None;
    v-wf:locationX "147"^^xsd:integer;
    v-wf:locationY "252"^^xsd:integer;
    v-wf:split v-wf:None;
    v-wf:startingMapping s-wf:map_doc_id, d:map_autoinstraction_notification_response;
.

d:task_autoinstruction_subnet_journal_hasFlow
    a v-wf:Flow;
    rdfs:isDefinedBy "http://semantic-machines.com/veda/complex-route-template"^^xsd:string;
    rdfs:label ""^^xsd:string;
    v-s:updateCounter "2"^^xsd:integer;
    v-wf:predicate "true"^^xsd:string;
    v-wf:flowsInto d:fszmffnqwfeqxxwr48vi9rq8 ;
.

d:fszmffnqwfeqxxwr48vi9rq8 a v-wf:Task;
    rdfs:isDefinedBy "http://semantic-machines.com/veda/complex-route-template"^^xsd:string;
    rdfs:label "Установка статуса [Исполнение]"^^xsd:string;
    v-s:updateCounter "3"^^xsd:integer;
    v-wf:executor s-wf:codelet_create_use_transformation;
    v-wf:hasFlow d:p1xmw8wb8k9cjjzgl5zifa65;
    v-wf:join v-wf:None;
    v-wf:locationX "227"^^xsd:integer;
    v-wf:locationY "349"^^xsd:integer;
    v-wf:split v-wf:None;
    v-wf:startingMapping s-wf:map_scr_uri_from_executor, d:map_transformation_setStatusExecution1;
.

d:p1xmw8wb8k9cjjzgl5zifa65 a v-wf:Flow;
    rdfs:isDefinedBy "http://semantic-machines.com/veda/complex-route-template"^^xsd:string;
    v-s:updateCounter "1"^^xsd:integer;
    v-wf:flowsInto d:task_autoinstruction_to_release;
    v-wf:predicate "true"^^xsd:string;
.

d:a33jy1sb1inmegt5j9ncswprh a v-wf:Task;
    rdfs:isDefinedBy "http://semantic-machines.com/veda/complex-route-template"^^xsd:string;
    rdfs:label "Установка статуса [Исполнено]"^^xsd:string;
    v-s:updateCounter "3"^^xsd:integer;
    v-wf:executor s-wf:codelet_create_use_transformation;
    v-wf:hasFlow d:rcw2c3a6efnmksft540vhdhj;
    v-wf:join v-wf:None;
    v-wf:locationX "434"^^xsd:integer;
    v-wf:locationY "352"^^xsd:integer;
    v-wf:split v-wf:None;
    v-wf:startingMapping s-wf:map_scr_uri_from_executor, d:map_transformation_setStatusExecuted1;
.

d:rcw2c3a6efnmksft540vhdhj a v-wf:Flow;
    rdfs:isDefinedBy "http://semantic-machines.com/veda/complex-route-template"^^xsd:string;
    rdfs:label ""^^xsd:string;
    v-s:updateCounter "1"^^xsd:integer;
    v-wf:flowsInto d:task_autoinstruction_to_release_link;
    v-wf:predicate "true"^^xsd:string;
.


d:mu18gdzzvp99huwicvj1qkre a v-wf:Task;
    rdfs:isDefinedBy "http://semantic-machines.com/veda/complex-route-template"^^xsd:string;
    rdfs:label "Установка статуса [Отклонено]"^^xsd:string;
    v-s:updateCounter "3"^^xsd:integer;
    v-wf:executor s-wf:codelet_create_use_transformation;
    v-wf:hasFlow d:bq1fgy9pb3rbz0bj43x4n41q;
    v-wf:join v-wf:None;
    v-wf:locationX "433"^^xsd:integer;
    v-wf:locationY "127"^^xsd:integer;
    v-wf:split v-wf:None;
    v-wf:startingMapping s-wf:map_scr_uri_from_executor, d:map_transformation_setStatusRejected1;
.

d:avqe3hv87i5asi5kfcpu9oop a v-wf:Flow;
    rdfs:isDefinedBy "http://semantic-machines.com/veda/complex-route-template"^^xsd:string;
    rdfs:label ""^^xsd:string;
    v-s:updateCounter "6"^^xsd:integer;
    v-wf:flowsInto d:mu18gdzzvp99huwicvj1qkre;
    v-wf:predicate "getUri (get_properties_chain (process.getLocalVariable ('decision_of_set_responsible'), [{$get:'rdf:type'}])) == 'v-wf:DecisionAcceptMotivatedRefusal'"^^xsd:string;
.


d:bq1fgy9pb3rbz0bj43x4n41q a v-wf:Flow;
    rdfs:isDefinedBy "http://semantic-machines.com/veda/complex-route-template"^^xsd:string;
    rdfs:label ""^^xsd:string;
    v-s:updateCounter "2"^^xsd:integer;
    v-wf:flowsInto d:task_autoinstruction_to_release_link;
    v-wf:predicate "true"^^xsd:string;
.

###--- дополнительные сущности к сети

d:map_autoinstruction_task_action
    rdf:type v-wf:Mapping ;
    v-wf:mapToVariable s-wf:var_actor_task_action ;
    v-wf:mappingExpression  "newStr ('Исполнить поручение')" ;
  rdfs:label "Actor_task_action <- 'Исполнить поручение'"^^xsd:string ;
.

d:executor_autoinstruction_notification_response
  rdf:type v-s:Codelet ;
  v-s:script
  """
  (function () {
    var mer = get_individual(task.ticket, process.getExecutor()[0].data);
    mer['v-wf:takenDecision'] = process.getLocalVariable ('decision_of_set_responsible');
    mer['v-s:dateFact'] = newDate(Date.now());
    put_individual(task.ticket, mer, _event_id);
    return [get_new_variable('res', newStr('OK'))];
    }());
  """;
  rdfs:label "Ответ из формы решения пользователя"@ru ;
.

d:executor_from_activity_responsible1
  rdf:type v-wf:ExecutorDefinition ;
  v-wf:executorExpression
  """
  get_properties_chain ( process.getExecutor(), [{$get:'v-s:responsible'}])
  """;
  rdfs:label "Исполнители из формы решения пользователя"@ru ;
.

d:task_autoinstruction_map_controller
  rdf:type v-wf:Mapping ;
  v-wf:mapToVariable s-wf:var_controller ;
  v-wf:mappingExpression  "get_properties_chain ( process.getExecutor(), [{$get:'v-s:controller'}])" ;
.

s-wf:map_msg_template_autoinstruction-universal
  rdf:type v-wf:Mapping ;
  v-wf:mapToVariable s-wf:var_msg_template ;
  v-wf:mappingExpression  "newUri ('s-wf:msg-template-universal')";
  rdfs:isDefinedBy s-wf: ;
.

d:task_autoinstraction_decision_for_instruction
  rdf:type v-wf:Mapping ;
  v-wf:mapToVariable s-wf:possible_decision ;
  v-wf:mappingExpression  "[newUri ('v-wf:DecisionAchieved'), newUri('v-wf:DecisionRejected'), newUri('v-wf:DecisionNotPerformed'), newUri('v-wf:DecisionRedirect'), newUri('v-wf:DecisionNotForMe')]" ;
  rdfs:label "Варианты ответа для исполнения"^^xsd:string;
.

d:map_decision_form_type_autoinstruction
  rdf:type v-wf:Mapping ;
    v-wf:mapToVariable s-wf:var_decision_form_type ;
  v-wf:mappingExpression  "newUri ('s-wf:UserTaskForm')";
  rdfs:label "Map decision_form_type = newUri ('s-wf:UserTaskForm')"@ru ;
.

d:map_autoinstraction_to_date
    rdf:type v-wf:Mapping ;
    v-wf:mapToVariable s-wf:var_actor_task_date_to ;
    v-wf:mappingExpression  "get_properties_chain (process.getExecutor(), [{$get:'v-s:dateTo'}])" ;
  rdfs:label "Контрольный срок"^^xsd:string ;
.

d:map_autoinstraction_notification_response
    rdf:type v-wf:Mapping ;
    v-wf:mapToVariable s-wf:var_result ;
    v-wf:mappingExpression  "process.getInputVariable ('decision_of_set_responsible')" ;
  rdfs:label "Контрольный срок"^^xsd:string ;
.

d:map_transformation_setStatusExecution1
        rdf:type v-wf:Mapping ;
        v-wf:mapToVariable s-wf:transformation_uri ;
        v-wf:mappingExpression  "newUri('mnd-s:set_StatusExecution')" ;
.

d:map_transformation_setStatusExecuted1
        rdf:type v-wf:Mapping ;
        v-wf:mapToVariable s-wf:transformation_uri ;
        v-wf:mappingExpression  "newUri('mnd-s:set_StatusExecuted')" ;
.

d:map_transformation_setStatusRejected1
        rdf:type v-wf:Mapping ;
        v-wf:mapToVariable s-wf:transformation_uri ;
        v-wf:mappingExpression  "newUri('mnd-s:set_StatusRejected')" ;
.
